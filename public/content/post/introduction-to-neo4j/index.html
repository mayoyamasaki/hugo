
<!DOCTYPE html>
<html lang="ja">
<head>

  
  <meta charset="UTF-8">
  <title>
    Introduction to Neo4j | Mayo&#39;s Blog
  </title>


  
  <meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1,initial-scale=1">

  
  <link rel="canonical" href="https://mayoyamasaki.github.io/content/post/introduction-to-neo4j/"/>

  
  <link rel="stylesheet" href="/css/sanitize.css">
  <link rel="stylesheet" href="/css/responsive.css">
  <link rel="stylesheet" href="/css/highlight_monokai.css">
  <link rel="stylesheet" href="/css/theme.css">
  <link rel="stylesheet" href="/css/custom.css">
  
  
  <link href="https://mayoyamasaki.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Mayo&#39;s Blog" />
  <link href="https://mayoyamasaki.github.io/index.xml" rel="feed" type="application/rss+xml" title="Mayo&#39;s Blog" />

  
  


</head>



<body>
<div class="container">

  
  <header role="banner">
    <div class="row gutters">
      <div id="site-title" class="col span_6">
        <h1><a href="https://mayoyamasaki.github.io/">Mayo&#39;s Blog</a></h1>
        
      </div>
      <div id="social" class="col span_6">
        <ul>
          <li><a href="https://twitter.com/mayoyamasaki" target="_blank">Twitter</a></li>
          
          <li><a href="https://github.com/mayoyamasaki" target="_blank">GitHub</a></li>
          <li><a href="https://mayoyamasaki.github.io/index.xml" type="application/rss+xml" target="_blank">RSS</a></li>
        </ul>
      </div>
    </div>
  </header>


  
  <main id="single" role="main">
    <div class="article-header">
      <h1>Introduction to Neo4j</h1>
      <div class="meta">
        Nov 16, 2016 &nbsp;
        
          #<a href="/tags/neo4j">Neo4j</a>&nbsp;
        
          #<a href="/tags/python">Python</a>&nbsp;
        
      </div>
    </div>
    <article>
      

<h2 id="概要">概要</h2>

<ul>
<li>Neo4jの公式ドキュメントを読んだので、概要をまとめた。</li>
<li>概念、クエリ文法、Pythonドライバの使い方について解説した。</li>
</ul>

<h2 id="はじめに">はじめに</h2>

<p><img src="/images/introduction-to-neo4j/neo4j_logo.png" alt="Neo4j" /></p>

<p>2016/11/15現在、Neo4jの最新版は、3系(3.0.7)で、公式サイトからdmg(Mac OSの場合)が配布されている<sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup>。<br />
公式ドキュメントのv3を斜め読みしたので、簡単に解説する<sup class="footnote-ref" id="fnref:2"><a rel="footnote" href="#fn:2">2</a></sup>。</p>

<h2 id="導入">導入</h2>

<p>Neo4jはスキーマレスDBで、グラフデータの扱い特化することで、高い検索パフォーマンスを発揮している。
データは、「Node」、「Relationship」、「Propetries」で表現される。<br />
下図の場合、PersonやMovieで囲まれいるオブジェクトがNodeで、Node間に貼られているエッジ(有効辺の場合は矢印)がRelationshipであり、各Nodeが所有するnameやbornなどの値がPropetriesである。</p>

<p><img src="/images/introduction-to-neo4j/graphdb-simple-labels.svg" alt="Example Graph" /></p>

<p>またNodeやRelationshipには、「Label」と呼ばれる複数個付与することができる。Labelは何らかの集合を意味し、上図の場合は、PersonやMovie、ACTED_INがLabelに相当する。</p>

<p>データはこれらの概念で表現されるが、グラフを探索する上で、「Path」と「Traversal」という概念がある。<br />
Pathは、Relationshipで接続されるNodeのことで、検索結果などを表す概念である。また、Traversalは検索方法を表す概念であり、「Tom HanksというNodeとACTED_INのRelationshipにあるNode」というようなクエリのことを意味している。この場合、Forrest GumpのNodeが下図のようなPathとして返されることになる。</p>

<p><img src="/images/introduction-to-neo4j/graphdb-path.svg" alt="Example Path" /></p>

<h2 id="入門">入門</h2>

<h3 id="cypher">Cypher</h3>

<p>Neo4jのデータは、Cypherと呼ばれるクエリ言語用いて扱う。例えば、Pathの例であげた図のデータをCypherで表現すると次の様になる(tomやgumpはアクセス用の変数である)。</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>(<span style="color: #A0A000">tom</span>:Person     {<span style="color: #A0A000">name</span>: <span style="color: #BA2121">&quot;Tom Hanks&quot;</span>, <span style="color: #A0A000">born</span>:<span style="color: #666666">1986</span>})
<span style="color: #666666">-</span>[<span style="color: #A0A000">role</span>:ACTED_IN {<span style="color: #A0A000">roles</span>: [<span style="color: #BA2121">&quot;Forrest&quot;</span>]}] <span style="color: #666666">-&gt;</span>
(<span style="color: #A0A000">gump</span>:Movie     {<span style="color: #A0A000">title</span>: <span style="color: #BA2121">&quot;Forrest Gump&quot;</span>, <span style="color: #A0A000">released</span>:<span style="color: #666666">1994</span>})
</pre></div>

<h3 id="データの作成と変数">データの作成と変数</h3>

<p>CREATE文でデータの作成、RETURNで変数からデータを取得できる。</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>CREATE (<span style="color: #A0A000">tom</span>:Person     {<span style="color: #A0A000">name</span>: <span style="color: #BA2121">&quot;Tom Hanks&quot;</span>, <span style="color: #A0A000">born</span>:<span style="color: #666666">1986</span>})
<span style="color: #666666">-</span>[<span style="color: #A0A000">role</span>:ACTED_IN {<span style="color: #A0A000">roles</span>: [<span style="color: #BA2121">&quot;Forrest&quot;</span>]}] <span style="color: #666666">-&gt;</span>
(<span style="color: #A0A000">gump</span>:Movie     {<span style="color: #A0A000">title</span>: <span style="color: #BA2121">&quot;Forrest Gump&quot;</span>, <span style="color: #A0A000">released</span>:<span style="color: #666666">1994</span>})
RETURN tom
</pre></div>

<h3 id="matchによるデータの検索">MATCHによるデータの検索</h3>

<p>データ表現をMATCHに渡すことで、複雑なクエリも構築できる。</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>MATCH (<span style="color: #A0A000">p</span>:Person { <span style="color: #A0A000">name</span>:<span style="color: #BA2121">&quot;Tom Hanks&quot;</span> })<span style="color: #666666">-</span>[<span style="color: #A0A000">r</span>:ACTED_IN]<span style="color: #666666">-&gt;</span>(<span style="color: #A0A000">m</span>:Movie)
RETURN m.title, r.roles
</pre></div>

<h3 id="データのマージ">データのマージ</h3>

<p>データやPropetriesが存在しないときだけ、その値を追加したい場合はMERGEが使える。</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>MERGE (<span style="color: #A0A000">m</span>:Movie { <span style="color: #A0A000">title</span>:<span style="color: #BA2121">&quot;Cloud Atlas&quot;</span> })
ON CREATE SET m.released <span style="color: #666666">=</span> <span style="color: #666666">2012</span>
RETURN m
</pre></div>

<h3 id="結果のフィルタリング">結果のフィルタリング</h3>

<p>RDBのSQLと同じく、WHEREによる条件指定やASによるエイリアス、ORDER BYによるソートなどの機能がある<sup class="footnote-ref" id="fnref:3"><a rel="footnote" href="#fn:3">3</a></sup>。</p>

<h2 id="ドライバ">ドライバ</h2>

<p>公式ドキュメントでは、C#、Java、JavaScrip、Pythonのドライバを紹介している<sup class="footnote-ref" id="fnref:4"><a rel="footnote" href="#fn:4">4</a></sup>。</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">neo4j.v1</span> <span style="color: #008000; font-weight: bold">import</span> GraphDatabase, basic_auth

driver <span style="color: #666666">=</span> GraphDatabase<span style="color: #666666">.</span>driver(
        <span style="color: #BA2121">&quot;bolt://localhost&quot;</span>, auth<span style="color: #666666">=</span>basic_auth(<span style="color: #BA2121">&quot;neo4j&quot;</span>, <span style="color: #BA2121">&quot;neo4j&quot;</span>), encrypted<span style="color: #666666">=</span><span style="color: #008000">True</span>)

session <span style="color: #666666">=</span> driver<span style="color: #666666">.</span>session()

session<span style="color: #666666">.</span>run(<span style="color: #BA2121">&quot;CREATE (a:Person {name:&#39;Arthur&#39;, title:&#39;King&#39;})&quot;</span>)

result <span style="color: #666666">=</span> session<span style="color: #666666">.</span>run(<span style="color: #BA2121">&quot;MATCH (a:Person) WHERE a.name = &#39;Arthur&#39; &quot;</span>
                      <span style="color: #BA2121">&quot;RETURN a.name AS name, a.title AS title&quot;</span>)

<span style="color: #008000; font-weight: bold">for</span> record <span style="color: #AA22FF; font-weight: bold">in</span> result:
    <span style="color: #008000; font-weight: bold">print</span>(<span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121"> </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">%</span> (record[<span style="color: #BA2121">&quot;title&quot;</span>], record[<span style="color: #BA2121">&quot;name&quot;</span>]))

session<span style="color: #666666">.</span>close()
</pre></div>

<p>これは、Pythonのサンプルプグラムのそのままであるが、このコードの理解だけで、問題なく利用できる。<br />
さて、boltスキーマを初めて見る人が多いと思うが、Neo4jが策定したバイナリネットワークプトトコルであるとのこと<sup class="footnote-ref" id="fnref:5"><a rel="footnote" href="#fn:5">5</a></sup>。</p>

<h2 id="おわりに">おわりに</h2>

<p>とりあえず基本的な内容は理解できたが、Cypherはパワフルなクエリ言語なので、全容はつかめていないが、とりあえず使う文には、難しくない様に感じた。<br />
今後は、Neo4jのグラフデータを可視化するツールはいくつかあり、<a href="http://www.popotojs.com/">Popotojs</a>が良さそうなので、これを試してみたい。</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1"><a href="https://neo4j.com/">neo4j</a>
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2"><a href="https://neo4j.com/docs/developer-manual/current/">The Neo4j Developer Manual v3.0</a>
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
<li id="fn:3"><a href="https://neo4j.com/docs/developer-manual/current/get-started/">Chapter 2. Get started</a>
 <a class="footnote-return" href="#fnref:3"><sup>[return]</sup></a></li>
<li id="fn:4"><a href="https://neo4j.com/docs/developer-manual/current/drivers/">Chapter 4. Drivers</a>
 <a class="footnote-return" href="#fnref:4"><sup>[return]</sup></a></li>
<li id="fn:5"><a href="https://www.infoq.com/jp/news/2016/05/neo4j-3.0">Neo4j 3.0がリリース，バイナリ通信プロトコルと標準ドライバを装備</a>
 <a class="footnote-return" href="#fnref:5"><sup>[return]</sup></a></li>
</ol>
</div>

      
      
      
    </article>
    
 <aside><div id="disqus_thread"></div></aside>

<script type="text/javascript">
     
    var disqus_shortname = 'mayoyamasaki';

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



  </main>
  
  <nav class="pagination-single">
    
      <span class="previous">&larr; <a href="https://mayoyamasaki.github.io/content/post/a-benchmark-of-scikit-learn-svm/" rel="prev">A Benchmark of scikit-learn SVMs</a></span>
    
    
      <span class="next"><a href="https://mayoyamasaki.github.io/content/post/kmeans%20clustering%20of%20word2vec%20on%20python/" rel="next">K-Means Clustering of Word2Vec on Python</a> &rarr;</span>
    
  </nav>


  
  <footer role="contentinfo">
    <div style="text-align:center;">
      
      Copyright (c) 2016, mayo yamasaki all rights reserved.
    </div>
  </footer>


</div>

<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



</body>
</html>

